name: ğŸ•·ï¸ Hourly RO Scraper

# è¨­å®šè§¸ç™¼å™¨ï¼šæ¯å°æ™‚çš„ 0 åˆ†é˜åŸ·è¡Œ (ä¾‹å¦‚ 01:00, 02:00, ...) 
on:
  schedule:
    # CRON èªæ³•ï¼š'0 * * * *' ä»£è¡¨åœ¨æ¯å€‹å°æ™‚çš„ 0 åˆ†é˜åŸ·è¡Œ (UTC æ™‚é–“)
    - cron: '0 * * * *' 
      
  # å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

# æˆäºˆ GITHUB_TOKEN å¯«å…¥æ¬Šé™ï¼Œä»¥ä¾¿æäº¤æ–°çš„ CSV æ–‡ä»¶
permissions:
  contents: write

jobs:
  run_scraper:
    runs-on: ubuntu-latest
    
    # è¨­å®šç’°å¢ƒè®Šæ•¸ä¾› Python è…³æœ¬ä½¿ç”¨
    env:
      AUCTION_USERNAME: ${{ secrets.AUCTION_USERNAME }} # å¾ GitHub Secrets è®€å–
      AUCTION_ID: ${{ secrets.AUCTION_ID }}             # å¾ GitHub Secrets è®€å–

    steps:
      # 1. Checkout ç¨‹å¼ç¢¼
      - name: â¬‡ï¸ Checkout repository code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }} 

      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' 

      # ã€ä¿®æ­£æ­¥é©Ÿã€‘ï¼šå®‰è£ Chrome ä¾è³´ã€OpenCV ä¾è³´å’Œ Xvfb
      - name: ğŸŒ Install required Chrome dependencies & Xvfb
        run: |
          sudo apt-get update
          # å®‰è£ Xvfb (è™›æ“¬é¡¯ç¤ºç·©è¡å€) ä»¥æ”¯æ´ headless=False
          sudo apt-get install -y xvfb
          # ä¿®æ­£ Chrome ä¾è³´åº«çš„åç¨± (é©ç”¨æ–¼ Ubuntu 24.04+)
          sudo apt-get install -y libnss3 libasound2t64 libatk-bridge2.0-0 libgtk-3-0
          
      # 3. å®‰è£ Python ä¾è³´
      - name: âš™ï¸ Install dependencies (Scraper)
        run: |
          # å¸¸ç”¨å·¥å…·
          pip install pandas tabulate
          # æ ¸å¿ƒçˆ¬èŸ²åº«
          pip install undetected-chromedriver selenium
          # åœ–åƒè­˜åˆ¥æ‰€éœ€å¥—ä»¶ (OpenCV, Pillow)
          pip install opencv-python Pillow
          
      # 4. é‹è¡Œ Python çˆ¬èŸ²è…³æœ¬
      - name: ğŸƒ Run main.py (Single Run)
        # ä½¿ç”¨ xvfb-run å•Ÿå‹•è™›æ“¬é¡¯ç¤ºå™¨ï¼Œè®“ headless=False èƒ½æˆåŠŸé‹è¡Œ
        run: xvfb-run --auto-servernum python main.py
