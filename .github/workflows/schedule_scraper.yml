name: ğŸ•·ï¸ Hourly RO Scraper

# è¨­å®šè§¸ç™¼å™¨ï¼šæ¯å°æ™‚çš„ 0 åˆ†é˜åŸ·è¡Œ (ä¾‹å¦‚ 01:00, 02:00, ...) 
on:
  schedule:
    # CRON èªæ³•ï¼š'0 * * * *' ä»£è¡¨åœ¨æ¯å€‹å°æ™‚çš„ 0 åˆ†é˜åŸ·è¡Œ (UTC æ™‚é–“)
    - cron: '0 * * * *' 
      
  # å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

# æˆäºˆ GITHUB_TOKEN å¯«å…¥æ¬Šé™ï¼Œä»¥ä¾¿æäº¤æ–°çš„ CSV æ–‡ä»¶
permissions:
  contents: write

jobs:
  run_scraper:
    runs-on: ubuntu-latest
    
    # è¨­å®šç’°å¢ƒè®Šæ•¸ä¾› Python è…³æœ¬ä½¿ç”¨
    env:
      AUCTION_USERNAME: ${{ secrets.AUCTION_USERNAME }} # è«‹åœ¨ repo settings ä¸­è¨­å®š
      AUCTION_ID: ${{ secrets.AUCTION_ID }}             # è«‹åœ¨ repo settings ä¸­è¨­å®š

    steps:
      # 1. Checkout ç¨‹å¼ç¢¼
      - name: â¬‡ï¸ Checkout repository code
        uses: actions/checkout@v4
        with:
          # ç¢ºä¿ Action èƒ½æ‹‰å–å’Œæ¨é€
          token: ${{ secrets.GITHUB_TOKEN }} 

      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          # ã€é‡è¦ä¿®æ­£ã€‘å°‡ç‰ˆæœ¬å›ºå®šåœ¨ 3.11ï¼Œé¿å… Python 3.12+ ç¼ºå°‘ distutils æ¨¡çµ„çš„éŒ¯èª¤ã€‚
          python-version: '3.11' 

      # ã€æ–°å¢æ­¥é©Ÿã€‘ï¼šå®‰è£å¿…è¦çš„ Chrome ä¾è³´åº«
      - name: ğŸŒ Install required Chrome dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libnss3 libgconf-2-4 libasound2 libatk-bridge2.0-0 libgtk-3-0
          
      # 3. å®‰è£ Python ä¾è³´
      - name: âš™ï¸ Install dependencies (Scraper)
        run: |
          pip install pandas tabulate
          pip install undetected-chromedriver selenium

      # 4. é‹è¡Œ Python çˆ¬èŸ²è…³æœ¬
      - name: ğŸƒ Run main.py (Single Run)
        # ã€ä¿®æ­£ã€‘ç¢ºå®šåŸ·è¡Œæª”æ¡ˆæ˜¯ main.py
        run: python main.py