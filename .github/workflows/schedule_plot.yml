name: 📊 Market Chart Daily Update

# 設定觸發器：每小時的 5 分鐘 (例如 01:05, 02:05, ...) 執行
on:
  schedule:
    # CRON 語法：'5 * * * *' 代表在每個小時的第 5 分鐘執行 (UTC 時間)
    - cron: '5 * * * *'
      
  # 允許手動觸發，方便測試
  workflow_dispatch:

# 授予 GITHUB_TOKEN 寫入權限，以便提交新的 HTML 文件
permissions:
  contents: write

jobs:
  update_and_deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout 程式碼
      - name: ⬇️ Checkout repository code
        # 使用 v4 版本，它支援 GITHUB_TOKEN 的權限
        uses: actions/checkout@v4

      # 2. 設定 Python 環境
      - name: 🐍 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # 使用您需要的 Python 版本

      # 3. 安裝 Python 依賴
      - name: ⚙️ Install dependencies (Scraper)
        run: |
          # 只需要安裝實際用到的庫，保持環境精簡
          pip install pandas tabulate
          pip install undetected-chromedriver selenium

      # 4. 運行 Python 腳本並生成 HTML 文件
      - name: 📊 Run Python script to generate HTML
        # 執行您的 plot.py 檔案
        run: python plot.py

      # 5. 自動提交並推送變動 (HTML 文件)
      # 使用一個專門的 Action 來處理 git add/commit/push 邏輯
      - name: ⬆️ Commit and Push new HTML
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # 告訴它要提交哪個檔案 (神之金屬_市場分析.html)
          file_pattern: '神之金屬_市場分析.html' 
          commit_message: "Auto-update: Market chart for 神之金屬 [skip ci]"
          # [skip ci] 確保這次 commit 不會再次觸發這個 workflow，避免無限循環