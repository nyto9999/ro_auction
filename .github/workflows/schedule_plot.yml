name: ğŸ“Š Market Chart Daily Update

# è¨­å®šè§¸ç™¼å™¨ï¼šæ¯å°æ™‚çš„ 30 åˆ†é˜ (ä¾‹å¦‚ 01:30, 02:30, ...) åŸ·è¡Œ
on:
  schedule:
    # é€™æ˜¯ UTC æ™‚é–“ï¼Œè«‹è‡ªè¡Œè½‰æ›ï¼š'30 * * * *' ä»£è¡¨æ¯å°æ™‚çš„ç¬¬ 30 åˆ†é˜
    - cron: '30 * * * *' 
  # å…è¨±æ‰‹å‹•è§¸ç™¼ï¼Œæ–¹ä¾¿æ¸¬è©¦
  workflow_dispatch:

# æˆäºˆ GITHUB_TOKEN å¯«å…¥æ¬Šé™ï¼Œä»¥ä¾¿æäº¤æ–°çš„ HTML æ–‡ä»¶
permissions:
  contents: write

jobs:
  update_and_deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout ç¨‹å¼ç¢¼
      - name: â¬‡ï¸ Checkout repository code
        # ä½¿ç”¨ v4 ç‰ˆæœ¬ï¼Œå®ƒæ”¯æ´ GITHUB_TOKEN çš„æ¬Šé™
        uses: actions/checkout@v4

      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # ä½¿ç”¨æ‚¨éœ€è¦çš„ Python ç‰ˆæœ¬

      # 3. å®‰è£ Python ä¾è³´
      - name: âš™ï¸ Install dependencies
        run: |
          # æ ¹æ“šæ‚¨çš„ç’°å¢ƒï¼Œå¯èƒ½éœ€è¦å®‰è£ requirements.txt ä¸­çš„æ‰€æœ‰ä¾è³´
          # å‡è¨­æ‚¨åªéœ€è¦ pandas, plotly
          pip install pandas plotly numpy

      # 4. é‹è¡Œ Python è…³æœ¬ä¸¦ç”Ÿæˆ HTML æ–‡ä»¶
      - name: ğŸ“Š Run Python script to generate HTML
        # åŸ·è¡Œæ‚¨çš„ plot.py æª”æ¡ˆ
        run: python plot.py

      # 5. è‡ªå‹•æäº¤ä¸¦æ¨é€è®Šå‹• (HTML æ–‡ä»¶)
      # ä½¿ç”¨ä¸€å€‹å°ˆé–€çš„ Action ä¾†è™•ç† git add/commit/push é‚è¼¯
      - name: â¬†ï¸ Commit and Push new HTML
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # å‘Šè¨´å®ƒè¦æäº¤å“ªå€‹æª”æ¡ˆ (ç¥ä¹‹é‡‘å±¬_å¸‚å ´åˆ†æ.html)
          # æ³¨æ„ï¼šé€™è£¡å‡è¨­æ‚¨çš„ plot.py è¼¸å‡ºçš„æª”æ¡ˆåç¨±å°±æ˜¯é€™å€‹
          file_pattern: 'ç¥ä¹‹é‡‘å±¬_å¸‚å ´åˆ†æ.html' 
          commit_message: "Auto-update: Market chart for ç¥ä¹‹é‡‘å±¬ [skip ci]"
          # [skip ci] ç¢ºä¿é€™æ¬¡ commit ä¸æœƒå†æ¬¡è§¸ç™¼é€™å€‹ workflowï¼Œé¿å…ç„¡é™å¾ªç’°
